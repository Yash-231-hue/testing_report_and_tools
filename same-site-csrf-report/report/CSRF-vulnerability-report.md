**Note:** This report was prepared as part of a cybersecurity training project and is based on ethical testing practices in a non-production environment.
________________________________________
Vulnerability Report
Title: SameSite=Lax Bypass via Cookie Refresh Leading to CSRF on Change Email Endpoint
Report ID: VR-XXXX-2025-08-10
Severity: High
Date Reported: August 10, 2025
Reported By: [Your Name / Redacted]
System Tested: Internal lab web application (no production systems involved)
________________________________________
1. Executive Summary
During security testing of an internal lab web application, I discovered a vulnerability that allows an attacker to perform a Cross-Site Request Forgery (CSRF) on the "change email" functionality. The application relies on SameSite=Lax cookies to mitigate CSRF risk but lacks additional protections such as anti-CSRF tokens or origin validation.
Because the backend accepts method override parameters (e.g., _method=POST) or headers, an attacker can craft a request that bypasses SameSite restrictions and causes the browser to send authenticated session cookies. This allows a malicious page to change the victim's email address without user interaction, potentially leading to account takeover or denial of service.
This is a known type of bypass that has been documented in public labs and security advisories.
________________________________________
2. Vulnerability Type
•	Cross-Site Request Forgery (CSRF)
•	Exploitation technique involves SameSite cookie behavior combined with method override or top-level navigation
•	This is a form of SameSite bypass via cookie refresh and method manipulation
________________________________________
3. Background
This vulnerability is based on a well-known class of CSRF bypass techniques. While SameSite cookies are intended to prevent CSRF by limiting when cookies are sent with cross-site requests, the "Lax" setting allows cookies to be sent with top-level navigations, which can be exploited.
When the backend accepts method override parameters or headers (such as _method=POST in the query string or X-Http-Method-Override), it may treat GET requests as if they were state-changing POST requests. This creates a gap that can be used to bypass the intended CSRF protection.
________________________________________
4. Discovery Method
The vulnerability was discovered during a manual security review of the account management features.
The steps taken were:
1.	Logging into the application and reviewing session cookies. The session used SameSite=Lax.
2.	Observing that the change-email functionality was implemented via a POST request without a visible anti-CSRF token.
3.	Testing if top-level navigations or redirects from an external site could send the required request.
4.	Crafting a test form on an external page that submitted a request to the vulnerable endpoint.
5.	Verifying that the browser sent the cookies and the backend processed the request without any CSRF validation.
________________________________________
5. Reproducible Steps (Redacted)
To safely reproduce the issue in a test environment:
1.	Log in to the application using a test account.
2.	Monitor requests to /my-account/change-email and confirm there is no CSRF token.
3.	Create an HTML form that submits a request to this endpoint, hosted on another domain.
4.	Add a method override parameter (_method=POST) or header if needed.
5.	Visit the malicious page while logged in. The browser will send the request with the session cookie, and the email change will be processed.
Note: These steps should only be performed in a controlled environment.
________________________________________
6. Root Cause
The core issue is the absence of proper CSRF protections on a sensitive, state-changing endpoint. Relying only on SameSite=Lax cookies does not prevent all CSRF attacks, especially when:
•	The backend allows request method overrides (query parameters or headers).
•	There is no CSRF token verification.
•	No validation of the Origin or Referer headers is performed.
This combination allows an attacker to trigger sensitive actions from another domain using a simple HTML form or redirect.
________________________________________
7. Risk and Impact Assessment
The impact of this vulnerability is high. If successfully exploited, it allows:
•	Changing the email address on a victim’s account without their knowledge.
•	Potential takeover of the account if the application allows password resets via email.
•	Denial of service, by locking a user out of their account.
The exploit requires only that the victim be logged in and visit a malicious site.
________________________________________
8. Detection and Logging Recommendations
To detect potential exploitation in logs, look for:
•	Requests to sensitive endpoints (e.g., /change-email) that include _method parameters or method override headers.
•	Requests from external referers or with missing/invalid CSRF tokens.
•	Unusual or frequent email change events.
•	Requests using GET or overridden methods that trigger state changes.
A detection rule could flag any state-changing request from an external referer using method override parameters.
________________________________________
9. Recommended Fixes
Short-Term (High Priority)
1.	Implement and validate anti-CSRF tokens on all state-changing requests.
2.	Disable or ignore method override parameters or headers on sensitive endpoints.
3.	Add server-side validation of the Origin or Referer headers for actions like changing emails.
4.	Set session cookies with SameSite=Strict and ensure they are marked HttpOnly and Secure.
Long-Term
1.	Use double-submit or synchronizer CSRF tokens tied to user sessions.
2.	Avoid using GET or GET-like requests for any state-changing actions.
3.	Add automated tests to check for missing CSRF protection in new features.
4.	Perform regular threat modeling, especially for login and account management flows.
________________________________________
10. Mitigation Steps (Temporary Measures)
Until the application is patched:
1.	Temporarily disable or restrict access to the email change endpoint.
2.	Reject any request that includes a method override parameter or header.
3.	Add a manual confirmation step (e.g., re-entering the password) before email changes.
4.	Notify users via email when their account email is changed.
________________________________________
11. Suggested QA Tests After Remediation
1.	Attempt to perform CSRF using a top-level navigation or form from another domain — the request should be rejected.
2.	Verify that SameSite cookies are applied and session integrity is maintained.
3.	Confirm that the backend ignores or blocks method override headers and parameters.
4.	Use tools such as Burp Suite or OWASP ZAP to validate CSRF protection.
________________________________________
12. References
•	PortSwigger Web Security Academy – CSRF Labs
•	OWASP CSRF Prevention Cheat Sheet
•	web.dev – SameSite Cookies Explained
•	Security advisories on method override and cookie refresh techniques
________________________________________
13. Closing Notes
This vulnerability was discovered through ethical testing in an isolated environment and has not been exploited in the wild. I recommend addressing this issue as a high priority due to the potential for account takeover.

